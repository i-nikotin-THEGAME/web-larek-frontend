# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении

Интерфейс для карирчки товара
```
export interface IItems {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number
}
```
Интерфейс для отправки готового заказа для отправки на сервер

```
export interface IOrder {
    payment: string;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: string[]
}
```
Данные товара испльзуемые для отображения предварительного просмотра карточки в модальном окне

```
export type TCardFull = Pick<ICard, 'id' | 'title' | 'price' | 'image' | 'category' | 'description'>
```
Данные товара для отображения списка карточек в корзине

```
export type TBaskeCompact = Pick<ICard, 'id' | 'title' | 'price'>;
```

Данные пользователя для оформления заказа

```
export type TFormOrder = Pick<IOrder, 'payment' | 'address' | 'email' | 'phone'>;
```

## Архитектура приложения

Код приложения разделен на слои гласно парадигме MVP:
- слой представления, отвечате за представление данных на странице,
- слой данных, отвечате за хранение и изменение данных,
- презентер, отвечате за связи представления и данные.

### Базовый код

#### Класс `Api`
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер,
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс `EventEmitter`
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.
Класс имеет методы:
- `on` — для подписки на событие,
- `off` — для отписки от события,
- `emit` — уведомления подписчиков о наступлении события.

Дополнительно реализованы методы:
- `onAll` —  для подписки на все события,
- `offAll` —  для сброса всех подписчиков.

Дополнительно есть метод `trigger` , генерирующий заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от класса `EventEmitter`.

### Слой данных

#### Класс CardsData

Класс отвечает за хранение и логику работы с данными карточек.\
Конструктор класса принимает инстант брокера событий.\

В полях класса хранятся следующие данные:
- `_cards: ICard[]` - массив объектов карточек
- `_preview: string | null` - id карточки, выбранной для просмотра в модальной окне,
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- `getCard(cardId: string)`: ICard - возвращает карточку по ее id,
- а так-же `сеттеры` и `геттеры` для сохранения и получения данных из полей класса

### Слой представления

Все классы представления отвечают за отображение вутри контейнера (DOM-екмент) переданных в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal

Реализует модальное окно.\
Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- `constructor(selector: string, events: IEvents)` Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса
- `content: HTMLElement` - элемент модального окна,
- `events: IEvents` - брокер событий.

#### Класс Page
Отвечает за отображение блока с карточками на главной странице.\
В конструктор принимает контейнер, в котором размещаются карточки.\
Сеттеры изменяют счетчик при изменении данных в корзине, заполняют главную страницу карточками, блокируют прокрутку страницы при открытии модального окна.


#### Класс Basket
Расширяет класс `Modal`. Предназначен для реализации модального окна отображения корзины с купленными товарами. При открытии модального окна сохраняет полученный в параметрах обработчик, который передается для выполнения при сабмите формы.\

Поля класса:
- `basketItems: TBaskeCompact` - Кнопка подтверждения,
- `list: HTMLFormElement` - элемент формы,
- `_total: HTMLFormElement` - элемент формы, подсчитывает итоговую сумму корзины,
- `button: HTMLElement` - кнопка при нажатия которой открывается модальное окно оформления заказа,
- `handleSubmit: Function` - функция, на выполнение которой запрашивается подтверждение.

Методы:
- `addItem(item: TBaskeCompact): void `- добавляет товар в корзину. При этом кнопка Купить становится не активной,
- `deleteItem(cardId: string): void` - удаляет товар в корзине, а кнопка Купить в карточке товара становится активной,
- `updatwBasketItems(basketList: HTMLElement[]): void` - перерисовывает модальное окно с корзиной, присваиет порядковый номер списка в соответствии со количеством товара в корзине,
- `get basketList(): HTMLElement[]` - геттер для получения списка товаров,
- `get lengthBasketItems(): number` - геттер для получения количества товаров в заказе.

#### Класс ModalWithForm
Расширяет класс `Modal`. Предназначен для реализации модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных.\
Предоставляет методы для отображения ошибок и управления активностью кнопки подтверждения.\
Поля класса:
- `submitButton: HTMLButtonElement` - Кнопка подтверждения,
- `_form: HTMLFormElement` - элемент формы,
- `formName: string` - значение атрибута name формы,
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы,
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов.

Методы:
- `setValid(isValid: boolean): void` - изменяет активность кнопки подтверждения
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - `name` инпута, значение - данные введенные пользователем
- `setInputValues(data: Record<string, string>): void` - принимает объект с данными для заполнения полей формы
- `setError(data: { field: string, value: string, validInformation: string }): void` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода
- `hideInputError (field: string): void` - очищает текст ошибки под указанным полем ввода
- `close (): void` - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- `get form: HTMLElement` - геттер для получения элемента формы

#### Класс Card 
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, категории, подробное описание и цены.\
Класс используется для отображения карточек на странице сайта.\
В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на просмотр подробного описания товара и добавления его в корзину, в результате взаимодействия с которыми пользователя генерируются соответствующие события. Если цена товара ровна `null` то кнопка Купить не активна\

Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

Методы:
- `render(data?: Partial<ICard>): HTMLElement` - расширяет родительский метод, обрабатывая отдельно данные категории товара, остальные данные передаются в родительский метод. Метод возвращает разметку карточки с установленными слушателями.
- геттер _id возвращает уникальный id карточки

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*

- `cards:changed` - изменение массива карточек,
- `card-basket:changed` - изменение массива списка товара в корзине,
- `initial:clearSet` - необходима очистка данных во всех формах и модальных окнах.

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

События открытия модальных окон:
- `card-preview:open` - открытие модального окна просмотра информации о товаре,
- `basket:open` - открытие модального окна просмотра корзины,
- `order:open` - открытие модального окна с формой оформления заказа: выбор способа оплаты и указание адреса доставки,
- `contacts:open` - открытие модального окна с формой оформления заказа: ввод электронной почты и ввод номера телефона,
- `success:open` - открытие модального окна с оповещением об успешном оформлении заказа.

События внутри модальных окон:
- `card-preview:select` - выбор товара для отображения в модальном окне,
- `card-preview:submit` - подтверждение выбора товара для добавления в корзину,
- `basket:delete` - удаление товара из корзины,
- `basket:submit` - подтверждение заверешения выбора товара и переход к оформлению заказа,
- `order-payment:checked` - выбор способа оплаты card или cash,
- `order:input` - изменение данных в форме выбора способа оплаты и ввода адреса доставки,
- `order:submit` - подтверждение заверешения ввода данных в форме выбора способа оплаты и ввода адреса доставки и перехода к следующей форме,
- `contacts:input` - изменение данных в форме ввода электронной почты и телефона,
- `contacts:submit` - подтверждение заверешения ввода данных в форме ввода электронной почты и телефона и перехода к оплате.

События валидации:
- `order:validation` - событие, сообщающее о необходимости валидации формы выбора способа оплаты и ввода адреса доставки,
- `contacts:validation` - событие, сообщающее о необходимости валидации формы ввода электронной почты и телефона.